{% extends "base.html" %}

{% block title %}Daily Dish{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dailyDish.css') }}">
{% endblock %}

{% block content %}
<div class="home-container">
    <h1 class="section-title">Daily Dish</h1>
    
    <!-- Hot on the Grill Section -->
    <section class="featured-section">
        <h2 class="section-subtitle">Hot on the Grill</h2>
        <p class="section-description">Todays Featured Dishes</p>
        
        <div class="carousel-container">
            <div class="carousel">
                {% for dish in featured_dishes %}
                <div class="carousel-item">
                    <a href="{{ url_for('dish.dish_detail', dish_id=dish.dish_id) }}" class="dish-image-container">
                        <img src="{{ url_for('static', filename=dish.image) }}" alt="{{ dish.name }}">
                        <div class="carousel-caption">{{ dish.name }} @  {{ dish.restaurant }}</div>
                    </a>
                </div>
                {% endfor %}
            </div>
            <button class="carousel-button prev">&lt;</button>
            <button class="carousel-button next">&gt;</button>
        </div>
        <div class="carousel-dots">
            {% for dish in featured_dishes %}
            <div class="carousel-dot"></div>
            {% endfor %}
        </div>
    </section>

    <!-- Live Feed Section -->
    <section class="live-feed">
        <h2 class="section-title">Live Feed</h2>
        <!-- Makes a card depending on the item type -->
        {% for item in feed_items %}

            <!-- Dish card for recommended dishes -->
            {% if item.type == 'dish' %}
                <div class="feed-item">
                    <a href="{{ url_for('dish.dish_detail', dish_id=item.data.dish_id) }}" class="card-link">
                        <div class="feed-header">
                            <span class="action">Recommended For You: {{ item.data.match_score }}% match</span>
                        </div>
                        <div class="feed-content"> 
                            <p>
                                {{ item.data.name }} @ 
                                <a href="{{ url_for('restaurant.restaurant_detail', restaurant_id=item.data.restaurant_id) }}" class="restaurant-link">
                                    {{ item.data.restaurant }}
                                </a>
                            </p>
                            <img src="{{ url_for('static', filename=item.data.image_path) }}" alt="{{ item.data.name }}">
                        </div>
                        <div class="feed-content">
                            <p>Your TasteBuddy {{ item.data.buddy_name }}'s review</p>
                            <img src="{{ url_for('static', filename=item.data.buddy_icon) }}" alt="{{ item.data.buddy_name }}" style="width: 75px; height: 75px">
                            <div class="star-rating">
                                <span>Rated:</span>
                                    {% set full = item.data.buddy_rating|int %}
                                    {% set empty = 5 - full %}

                                    {% for _ in range(full) %}
                                        <i class = "fas fa-star"></i>
                                    {% endfor %}
                    
                                    {% for _ in range(empty) %}
                                        <i class = "far fa-star"></i>
                                    {% endfor %}
                            </div>
                            <p>{{ item.data.review_content }}</p>
                        </div>
                        <div class="feed-footer">
                            <span class="timestamp">{{ item.data.time_stamp }}</span>
                            <div class="feed-actions">
                                <i class="far fa-star"></i>
                                <i class="fas fa-share"></i>
                                <i class="fas fa-ellipsis-h"></i>
                            </div>
                        </div>
                    </a>
                </div>

            <!-- Review card for friends reviews -->
            {% elif item.type == 'review' %}
                <div class="feed-item">
                    <a href="{{ url_for('dish.dish_detail', dish_id=item.data.dish_id) }}" class="card-link">
                        <div class="feed-header">
                            <span class="friend">Your friend {{ item.data.friend_name }} reviewed </span>
                            <br>
                            <span class="action">{{ item.data.dish_name }} @ 
                                <a href="{{ url_for('restaurant.restaurant_detail', restaurant_id=item.data.restaurant_id) }}" class="restaurant-link">
                                    {{ item.data.restaurant_name }}
                                </a>
                            </span>
                        </div>
                        <div class="feed-content">
                            <img src="{{ url_for('static', filename=item.data.friend_icon) }}" alt="{{ item.data.friend_name }}" style="width: 75px; height: 75px">
                            <div class="star-rating">
                                <span>Rated:</span>
                                    {% set full = item.data.rating|int %}
                                    {% set empty = 5 - full %}

                                    {% for _ in range(full) %}
                                        <i class = "fas fa-star"></i>
                                    {% endfor %}
                
                                    {% for _ in range(empty) %}
                                        <i class = "far fa-star"></i>
                                    {% endfor %}
                            </div>
                            <p>{{ item.data.content }}</p>
                        </div>
                        <div class="feed-footer">
                            <span class="timestamp">{{ item.data.time_stamp }}</span>
                        </div>
                    </a>
                </div>

            <!-- Saved card for dishes from saved list -->
            {% elif item.type == 'saved' %}
                <div class="feed-item">
                    <a href="{{ url_for('dish.dish_detail', dish_id=item.data.dish_id) }}" class="card-link">
                        <div class="feed-header">
                            <span class="action">From Your Saved Dishes</span>
                        </div>
                        <div class="feed-content"> 
                            <p>
                                {{ item.data.dish_name }} @ {{ item.data.restaurant_name }}
                            </p>
                            <img src="{{ url_for('static', filename=item.data.image) }}" alt="{{ item.data.dish_name }}">
                        </div>
                        <div class="feed-footer">
                            <span class="timestamp">Saved on {{ item.data.date_saved }}</span>
                        </div>
                    </a>
                </div>
            {% endif %}

        {% endfor %}

        <div class="feed-item">
            <div class="feed-header">
                <span class="username">MelCollie</span>
                <span class="action">left a new dish review @ The Baattery</span>
            </div>
            <div class="feed-content">
                <p class="private-content">private</p>
                <img src="{{ url_for('static', filename='images/profile_icons/default2.png') }}" alt="User profile" class="profile-pic">
            </div>
            <div class="feed-footer">
                <span class="timestamp">1 hour ago</span>
                <div class="feed-actions">
                    <i class="far fa-star"></i>
                    <i class="fas fa-share"></i>
                    <i class="fas fa-ellipsis-h"></i>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- Add JavaScript for carousel functionality -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.querySelector('.carousel');
    const items = document.querySelectorAll('.carousel-item');
    const dots = document.querySelectorAll('.carousel-dot');
    const prevBtn = document.querySelector('.carousel-button.prev');
    const nextBtn = document.querySelector('.carousel-button.next');
    let currentIndex = 0;

    function showItem(index) {
        const offset = -index * 100;
        carousel.style.transform = `translateX(${offset}%)`;
        
        // Update dots
        dots.forEach((dot, i) => {
            dot.classList.toggle('active', i === index);
        });
    }

    // Initialize first dot as active
    dots[0].classList.add('active');

    // Add click handlers for dots
    dots.forEach((dot, index) => {
        dot.addEventListener('click', () => {
            currentIndex = index;
            showItem(currentIndex);
        });
    });

    prevBtn.addEventListener('click', () => {
        currentIndex = Math.max(currentIndex - 1, 0);
        showItem(currentIndex);
    });

    nextBtn.addEventListener('click', () => {
        currentIndex = Math.min(currentIndex + 1, items.length - 1);
        showItem(currentIndex);
    });
});
</script>

{% endblock %}