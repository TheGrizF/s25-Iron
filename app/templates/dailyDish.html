{% extends "base.html" %}

{% block title %}Daily Dish{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dailyDish.css') }}">
{% endblock %}

{% block content %}
<div class="page-wrapper">
    <div class="home-container">
        <h1 class="section-title">Daily Dish</h1>
        
        <!-- Hot on the Grill Section -->
        <section class="featured-section">
            <h2 class="section-subtitle">Hot on the Grill</h2>
            <p class="section-description">Todays Featured Dishes</p>
            
            <div class="carousel-container">
                <div class="carousel">
                    {% for dish in featured_dishes %}
                    <div class="carousel-item">
                        <a href="{{ url_for('dish.dish_detail', dish_id=dish.dish_id) }}" class="dish-image-container">
                            <img src="{{ url_for('static', filename=dish.image) }}" alt="{{ dish.name }}">
                            <div class="carousel-caption">{{ dish.name }} @  {{ dish.restaurant }}</div>
                        </a>
                    </div>
                    {% endfor %}
                </div>
                <button class="carousel-button prev">&lt;</button>
                <button class="carousel-button next">&gt;</button>
            </div>
            <div class="carousel-dots">
                {% for dish in featured_dishes %}
                <div class="carousel-dot"></div>
                {% endfor %}
            </div>
        </section>

        <!-- Live Feed Section -->
        <section class="live-feed">
            <h2 class="section-title">Live Feed</h2>
            <!-- Makes a card depending on the item type -->
            {% for item in feed_items %}

                <!-- Dish card for recommended dishes -->
                {% if item.type == 'dish' %}
                    <div class="feed-item">
                        <a href="{{ url_for('dish.dish_detail', dish_id=item.data.dish_id) }}" class="card-link">
                            <div class="dish-section">
                                <div class="dish-info">
                                    <div class="recommendation-header">Recommended for you</div>
                                    <div class="dish-header">
                                        <span class="dish-title">{{ item.data.name }}</span> @ 
                                        <a href="{{ url_for('restaurant.restaurant_detail', restaurant_id=item.data.restaurant_id) }}" class="restaurant-link">
                                            {{ item.data.restaurant }}
                                        </a>
                                    </div>
                                    <div class="match-score">{{ item.data.match_score }}% taste match</div>
                                    
                                    <div class="compact-review">
                                        <p class="buddy-intro">Your TasteBuddy {{ item.data.buddy_name }}'s review</p>
                                        <div class="buddy-review">
                                            <img src="{{ url_for('static', filename=item.data.buddy_icon) }}" alt="{{ item.data.buddy_name }}" class="buddy-icon">
                                            <div class="review-content">
                                                <div class="star-rating">
                                                    <span>Rated:</span>
                                                    {% set full = item.data.buddy_rating|int %}
                                                    {% set empty = 5 - full %}

                                                    {% for _ in range(full) %}
                                                        <i class="fas fa-star"></i>
                                                    {% endfor %}
                        
                                                    {% for _ in range(empty) %}
                                                        <i class="far fa-star"></i>
                                                    {% endfor %}
                                                </div>
                                                <p class="review-text">{{ item.data.review_content }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="dish-image">
                                    <img src="{{ url_for('static', filename=item.data.image_path) }}" alt="{{ item.data.name }}">
                                </div>
                            </div>

                            <div class="feed-footer">
                                <span class="timestamp">{{ item.data.time_stamp }}</span>
                                <div class="feed-actions">
                                    <i class="far fa-star"></i>
                                    <i class="fas fa-share"></i>
                                    <i class="fas fa-ellipsis-h"></i>
                                </div>
                            </div>
                        </a>
                    </div>

                <!-- Review card for friends reviews -->
                {% elif item.type == 'review' %}
                    <div class="feed-item">
                        <a href="{{ url_for('dish.dish_detail', dish_id=item.data.dish_id) }}" class="card-link">
                            <div class="feed-header">
                                <span class="friend">Your friend {{ item.data.friend_name }} reviewed </span>
                                <br>
                                <span class="action">
                                    <span class="dish-title">{{ item.data.dish_name }}</span> @ 
                                    <a href="{{ url_for('restaurant.restaurant_detail', restaurant_id=item.data.restaurant_id) }}" class="restaurant-link">
                                        {{ item.data.restaurant_name }}
                                    </a>
                                </span>
                            </div>
                            <div class="feed-content">
                                <img src="{{ url_for('static', filename=item.data.friend_icon) }}" alt="{{ item.data.friend_name }}" style="width: 75px; height: 75px">
                                <div class="review-content">
                                    <div class="star-rating">
                                        <span>Rated:</span>
                                        {% set full = item.data.rating|int %}
                                        {% set empty = 5 - full %}

                                        {% for _ in range(full) %}
                                            <i class = "fas fa-star"></i>
                                        {% endfor %}
                    
                                        {% for _ in range(empty) %}
                                            <i class = "far fa-star"></i>
                                        {% endfor %}
                                    </div>
                                    <p class="review-text">{{ item.data.content }}</p>
                                </div>
                            </div>
                            <div class="feed-footer">
                                <span class="timestamp">{{ item.data.time_stamp }}</span>
                            </div>
                        </a>
                    </div>

                <!-- Saved card for dishes from saved list -->
                {% elif item.type == 'saved' %}
                    <div class="feed-item">
                        <a href="{{ url_for('dish.dish_detail', dish_id=item.data.dish_id) }}" class="card-link">
                            <div class="dish-section">
                                <div class="dish-info">
                                    <div class="feed-header">
                                        <span class="action">From Your Saved Dishes</span>
                                    </div>
                                    <p class="dish-header">
                                        <span class="dish-title">{{ item.data.dish_name }}</span> @ 
                                        <a href="{{ url_for('restaurant.restaurant_detail', restaurant_id=item.data.restaurant_id) }}" class="restaurant-link">
                                            {{ item.data.restaurant_name }}
                                        </a>
                                    </p>
                                </div>
                                <div class="dish-image">
                                    <img src="{{ url_for('static', filename=item.data.image) }}" alt="{{ item.data.dish_name }}">
                                </div>
                            </div>
                            <div class="feed-footer">
                                <span class="timestamp">Saved on {{ item.data.date_saved }}</span>
                            </div>
                        </a>
                    </div>

                {% elif item.type == 'update' %}
                    <div class="feed-item">
                        <a href="{{ url_for('restaurant.restaurant_detail', restaurant_id=item.data.restaurant_id) }}" class="card-link">
                            <div class="update-section">
                                <div class="update-header">
                                    <button class="update-button" type="button">
                                        Live Update <i class="fas fa-bullhorn"></i>
                                    </button>
                                </div>
                                <div class="update-body">
                                    <p class="update-info">
                                        {{ item.data.user_name }} posted an update at {{ item.data.restaurant_name }}:
                                    </p>
                                    <p class="update-content">{{ item.data.content }}</p>
                                </div>
                                <div class="update-footer">
                                    On {{ item.data.time_posted }}
                                </div>
                            </div>
                        </a>
                    </div>
                {% endif %}

            {% endfor %}
        </section>
    </div>
</div>

<!-- Add JavaScript for carousel functionality -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.querySelector('.carousel');
    const items = document.querySelectorAll('.carousel-item');
    const dots = document.querySelectorAll('.carousel-dot');
    const prevBtn = document.querySelector('.carousel-button.prev');
    const nextBtn = document.querySelector('.carousel-button.next');
    let currentIndex = 0;

    function showItem(index) {
        const offset = -index * 100;
        carousel.style.transform = `translateX(${offset}%)`;
        
        // Update dots
        dots.forEach((dot, i) => {
            dot.classList.toggle('active', i === index);
        });
    }

    // Initialize first dot as active
    dots[0].classList.add('active');

    // Add click handlers for dots
    dots.forEach((dot, index) => {
        dot.addEventListener('click', () => {
            currentIndex = index;
            showItem(currentIndex);
        });
    });

    prevBtn.addEventListener('click', () => {
        currentIndex = Math.max(currentIndex - 1, 0);
        showItem(currentIndex);
    });

    nextBtn.addEventListener('click', () => {
        currentIndex = Math.min(currentIndex + 1, items.length - 1);
        showItem(currentIndex);
    });
});
</script>

{% endblock %}